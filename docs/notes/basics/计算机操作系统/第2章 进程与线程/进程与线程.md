---
title: 进程与线程
createTime: 2024/12/18 10:40:11
permalink: /basics/计算机操作系统/第2章 进程与线程/进程与线程/
---

## 进程的概念
程序：是 **静态的** ，就是个存放在磁盘里的可执行文件，就是一系列的指令集合

进程（Process）：是 **动态的** ，是程序的一次执行过程



## 进程的组成

一个进程实体（进程映像）由 **进程控制块（PCB）** 、**程序段** 、**数据段** 组成


### 进程控制块（PCB）

**进程控制块（PCB）** 是进程存在的唯一标志，当进程被创建时，操作系统为其创建PCB，当进程结束时，会回收PCB

当进程被创建时，操作系统会为该进程分配一个 **唯一的、不重复** 的“身份证号”-PID（Process ID，进程ID）

操作系统要记录PID、进程所属用户ID（UID）、进程资源分配（如：内存，I/O设备、文件），进程运行情况（如：CPU使用时间，磁盘使用情况，网络流量使用情况）等

这些信息都被保存在一个数据结构 PCB（Process Control Block）中，即 **进程控制块**


### 程序段

程序的代码（指令序列）


### 数据段

运行过程中产生的各种数据（如：程序中定义的变量）



![201进程的组成](/images/basics/计算机操作系统/201进程的组成.png)

## 程序是如何运行的

![203程序是如何运行的](/images/basics/计算机操作系统/203程序是如何运行的.png)



### 常用寄存器

#### PSW：程序状态字寄存器

存储 CPU 的运行状态信息（用户态|内核态）

#### PC：程序计数器

存储当前正在执行的指令地址和下一条执行的指令地址

#### IR：指令寄存器

存储当前正在执行的指令

#### 通用寄存器

其他一些必要信息



## 进程的特征

![204进程的特征](/images/basics/计算机操作系统/204进程的特征.png)



## 进程的状态与转换

### 创建态

![205进程的状态](/images/basics/计算机操作系统/205进程的状态-创建态就绪态.png)



### 运行态

![206程序的状态-运行态](/images/basics/计算机操作系统/206程序的状态-运行态.png)



### 阻塞态

![207进程的状态-阻塞态](/images/basics/计算机操作系统/207进程的状态-阻塞态.png)



### 终止态

![208进程的状态-终止态](/images/basics/计算机操作系统/208进程的状态-终止态.png)



### 进程是如何状态转换的

![209进程是如何状态转换的](/images/basics/计算机操作系统/209进程是如何状态转换的.png)



### 进程的状态总结

![210进程的状态总结1](/images/basics/计算机操作系统/210进程的状态总结1.png)



![210进程的状态总结2](/images/basics/计算机操作系统/210进程的状态总结2.png)



## 进程的组织



### 链接方式

按照进程状态将PCB分为多个队列

操作系统持有指向各个队列的指针

![211进程的组织-链接方式](/images/basics/计算机操作系统/211进程的组织-链接方式.png)



### 索引方式

根据进程状态的不同，建立几张索引表

操作系统持有指向各个索引表的指针

![212进程的组织-索引方式](/images/basics/计算机操作系统/212进程的组织-索引方式.png)



## 进程控制

进程控制的主要功能是对系统中的所有进程实施有效的管理，它具有创建新进程、撤销已有进程、实现进程状态转换等功能。



### 如何实现进程控制

使用 ”原语“ 实现，原语的执行具有原子性，期间不允许被中断



### 原语的 ”原子性“

通过 **关中断指令** 和 **开中断指令** 这两个 **特权指令** 实现 **原子性**



### 中断机制

#### 关中断指令

用于 **禁用CPU响应中断请求**，表示临时关闭中断系统，执行关中断指令后，CPU将不再响应外部中断信号，直到执行开中断指令。

**作用**：防止在关键代码执行过程被中断打断，确保指令的原子性。



#### 开中断指令

用于 **重新启用CPU响应中断请求**，表示允许中断系统正常工作，执行开中断指令后，处理器会检查和响应外部中断信号。

**作用**：恢复对外部中断的响应



#### 中断机制的工作流程
1. 外设或内部模块产生中断信号
2. 如果中断被启用（CPU处于 **开中断状态**），中断控制器将信号传递给CPU。
3. CPU暂停当前任务，保存上下文，跳转到中断服务程序。
4. 完成中断服务后，恢复上下文，继续执行被中断的任务。

CPU 会按程序的 **指令序列** 依次执行指令，每执行完一条指令都会例行检查是否有中断信号需要处理，如果有，则暂停运行当前程序，执行 **关中断指令**，转而执行中断程序，，等中断程序处理完之后，会执行 **开中断指令**，并且回到原来程序继续往下执行。

**注意**：在中断程序的执行过程中，不需要再例行检查中断信号了，因为已经执行 **关中断指令** 了，等待当前中断程序处理完之后，回到程序后，再次出现外部中断信号，则继续去执行中断程序。



## 进程通信

### 为什么需要进程通信？

进程是分配系统资源的单位（包括内存地址空间），每个进程都拥有独立的内存地址空间和资源。因此访问其他进程的数据是不可能的，为了实现进程之间的数据交换，他们必须通过进程通信机制来实现。



### 通信方式

#### 共享存储（共享内存）

共享存储允许多个进程映射到同一块内存区域，从而直接访问和修改内存中的数据。

为避免出错，各个进程对共享空间的访问应该是互斥的，各个进程可使用操作系统内核提供的同步互斥工具（如P、V操作）

##### 基于数据结构

比如共享空间里只能放一个长度为10的数组，这种共享方式速度慢、限制多，是一种低级通信方式

##### 基于存储区

操作系统在内存中划出一块恭喜那个存储区，数据的形式、存放位置都由通信进程控制，而不是操作系统。这种共享方式速度很快，是一种高级通信方式。

#### 消息队列

进程间的数据交换以 **格式化的消息（Message）**为单位。进程通过操作系统提供的“发送消息/接收消息”两个原语进行数据交换

##### 直接通信方式

消息发送进程要指明接收进程的ID

在直接通信方式中，消息队列的发送者和接受者是直接连接的，即每个消息都由一个明确的发送者和接受者。消息的传递是点对点的，发送者将消息发送到接受者的消息队列，接受者从消息队列中取出消息。

**特点：**

- 点对点通信：每条消息只能由一个接受者接收

- 发送者和接收者明确，发送方和接收方需要显式的指定对方标识。
- 实时性强，接收方从消息队列中获取消息时，是直接与发送方对应的，通信较为直接和快速

**使用场景：**

- 请求-响应模式：例如，在客户端与服务器之间进行通信时，客户端发送请求消息，服务器返回响应消息，采用直接通信方式。
- 命令通知：例如，发送系统命令或操作指令给特定的进程或服务。

![214进程通信直接通信方式](/images/basics/计算机操作系统/214进程通信直接通信方式.png)




##### 间接通信方式（信箱通信方式）

通过“信箱”间接地通信，因此又称“信息通信方式”

在间接通信方式中，消息并不直接从发送者传递到接收者，而是通过一个中间的消息队列或消息交换代理来转发。消息首先进入一个中介的消息队列，接收者从该中介队列中读取消息。发送者和接收者之间不需要直接对接，消息队列作为一个“中介”角色存在。

**特点：**

- 广播式通信：一条消息可以发送给多个接收者（取决于消息队列的设计）。

- 解耦性强：发送者与接收者之间不直接关联，发送者只需将消息放入消息队列，接收者从消息队列获取消息。这种方式使得发送者与接收者之间实现了解耦。

- 异步通信：发送者发送消息后不需要等待接收者的响应，接收者可以在任意时间处理消息，适合异步处理任务。

![215进程通信间接通信方式](/images/basics/计算机操作系统/215进程通信间接通信方式.png)



#### 管道通信

管道只能采用 **半双工通信**，某一时间段内只能实现单向的传输。如果要实现 双向同时通信，则需要设置两个管道。

各进程要互斥地访问管道（由操作系统实现）。

当管道写满时，写进程将阻塞，知道读进程将管道中的数据取走，即可唤醒写进程。

当管道读空时，读进程将阻塞，知道写进程往管道中写入数据，即可唤醒读进程。

管道中的数据一旦被读出，就彻底消失。因此，当多个进程读同一个管道时，可能会错乱。对此，通常有两种解决方案：1. 一个管道允许多个写进程，一个读进程（2014408真题高教社官方答案）；2. 允许有多个写进程，多个读进程，但系统会让各个读进程轮流从管道中读数据（Linux方案）

![216进程通信-管道通信](/images/basics/计算机操作系统/216进程通信-管道通信.png)











